var greetQuery,pushQuery,errorMsg='죄송합니다. 문의하신 내용을 찾는데 문제가 발생했습니다.<br>잠시 후 다시 질문해주시기 바랍니다.',question_top_html='<li class="new_message_balloon_area answer_area">';question_top_html+='<div>';var question_bottom_html='</div>';question_bottom_html+='<p class=\'chat_time _q\'>1</p>',question_bottom_html+='</li>';var loading_html='<li class=\'new_message_balloon_area\' id=\'loading\'>';loading_html+='<p class=\'txt_conversation\' style=\'line-height:24px;\' aria-label=\'알림 내용\'>',loading_html+='<div class=\'loading_wrap\'>',loading_html+='</p></div>',loading_html+='<p class=\'chat_time\'></p>',loading_html+='</li>';var callback,xhr,lastUsedNumber=0,hasGreeted=!1,typingFinished=!1,user_ip='',chatUrl='https://chat-saas.ontime.co.kr:28500/';callback=function(e){user_ip=e,setApiKey()},(xhr=new XMLHttpRequest).onreadystatechange=function(){if(4===xhr.readyState&&200===xhr.status){var e=JSON.parse(xhr.responseText);callback(e.ip)}},xhr.open('GET','https://api64.ipify.org?format=json',!0),xhr.send();const secretKey='jk+EVDJNhUyCLHYXYc9mnCTs8dceocB1lnaGIzeG2DGNh7WF08NZVmwFXIL5bU1t';function setApiKey(){new Date;const e=function(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,'0')}-${String(e.getDate()).padStart(2,'0')} ${String(e.getHours()).padStart(2,'0')}:${String(e.getMinutes()).padStart(2,'0')}:${String(e.getSeconds()).padStart(2,'0')}`}(),t={name_id:'sample',service_id:'sample service',user_ip:user_ip,date_time:e},a=JSON.stringify(t);API_KEY=function(e){const t=CryptoJS.SHA256(secretKey),a=CryptoJS.lib.WordArray.random(16),s=CryptoJS.AES.encrypt(e,t,{iv:a,padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC});return a.concat(s.ciphertext).toString(CryptoJS.enc.Base64)}(a)}$(document).ready(function(){greetQuery='gmup_g',pushQuery='gmup_p',async.waterfall([function(e){greet=!0,oneWayQuery(true)}],function(e){e||($('.time:last').text(getHour()),$('#sentence').focus())});$(document).on('click','.question-btn',function(){var e=$(this).data('target'),t=$('#'+e).text(),a=$('#index').val(),s=$('#chatmodel').val();setApiKey(),typingFinished||$.ajax({url:chatUrl+'/api_cs_chatbot_common',type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',dataType:'json',data:{message:t,index:a,model:s,faqAdd:!0,user_ip:user_ip,API_KEY:API_KEY},beforeSend:function(){var e='';e+=question_top_html,e+=escapeHtml(t),e+=question_bottom_html,e+=loading_html,$('.chat_list').append(e),$('.chat_time._q:last').text(getHour()),$('.chat_list').scrollTop($('.chat_list')[0].scrollHeight)},success:function(e){ajaxAnswerSuccess(e,'Y'),$('.chat_time:last').text(getHour())},error:function(e,t,a){doAnswer(errorMsg)}})}),$(document).on('click','.btn_replay',function(){var e=$(this).closest('.evalution_area'),t=e.closest('.message_balloon').closest('li').prevAll('.new_message_balloon_area.answer_area').first().find('div').text().trim();if(t&&!e.data('already-clicked')){e.data('already-clicked',!0);var a=$('#index').val(),s=$('#chatmodel').val();setApiKey(),typingFinished||$.ajax({url:chatUrl+'/api_cs_chatbot_common',type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',dataType:'json',data:{message:t,index:a,model:s,user_ip:user_ip,API_KEY:API_KEY,Srh_Pre_Faq:!1},beforeSend:function(){var e='';e+=question_top_html,e+=escapeHtml(t),e+=question_bottom_html,e+=loading_html,$('.chat_list').append(e),$('.chat_time._q:last').text(getHour()),$('.chat_list').scrollTop($('.chat_list')[0].scrollHeight)},success:function(e){ajaxAnswerSuccess(e,'Y'),$('.chat_time:last').text(getHour())},error:function(e,t,a){doAnswer(errorMsg)}})}}),$(document).on('click','.btn_good, .btn_bad',function(){var e=$(this),t=e.data('type'),a=e.closest('.evalution_area'),s=a.data('escaped-message'),n=a.data('escaped-reply');a.data('already-clicked')||(setApiKey(),$.ajax({url:chatUrl+'/cx_evaluate',type:'POST',data:{message:encodeURIComponent(s),index:$('#index').val(),cx_eval:t,API_KEY:API_KEY,assistant_reply:encodeURIComponent(n)},success:function(e){'like'===t?a.find('.btn_good').addClass('on').siblings('.btn_bad').removeClass('on'):'dislike'===t&&a.find('.btn_bad').addClass('on').siblings('.btn_good').removeClass('on'),a.data('already-clicked',!0)},error:function(e){}}))})});var oneWayQuery=function(e){if(!hasGreeted){var t=$('#index').val(),a=e?greetQuery:pushQuery,s=$('#chatmodel').val();$('#sentence').off('keydown'),'gmup_g'==a?$.ajax({url:chatUrl+'/api_client_set',type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',dataType:'json',data:{index:t},success:function(e){ajaxAnswerSuccess({msg:'first',topQuest:e.client_settings.top_recommend,reply:e.client_settings.introduction,title:e.client_settings.title},'N')},error:function(e,t,a){}}):(setApiKey(),$.ajax({url:chatUrl+'/api_cs_chatbot_common',type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',dataType:'json',data:{message:a,index:t,chatmodel:s,user_ip:user_ip},beforeSend:function(){var e='';e+=loading_html,$('.chat_list').append(e),$('.chat_time:last').text(getHour()),$('.chat_list').scrollTop($('.chat_list')[0].scrollHeight)},success:function(e){ajaxAnswerSuccess(e,'N')},error:function(e,t,a){doAnswer(errorMsg)}})),hasGreeted=!0}};function getHour(){return function(e){let t=parseInt(e.substring(0,2)),a=t<12?'오전':'오후';return t=t%12||12,a+' '+('0'+t).slice(-2)+e.slice(-3)}(checkTime((new Date).getHours())+':'+checkTime((new Date).getMinutes()))}var removedSuffix='';var title='';function doAnswer(e,t,a){$('#loading').remove();var s='';if('first'==t);else{s='<div class=\'evalution_area\' data-escaped-message=\''+escapeHtml(e.message)+'\' data-escaped-reply=\''+escapeHtml(e.reply)+'\' data-already-clicked=\'false\'>';s+='<button class=\'btn_good tooltip\' data-type=\'like\'><em class=\'bull_tail\'></em><span class=\'tooltiptext tooltip-bottom\'>좋아요</span><span class=\'screenOut\'>좋아요</span></button>',s+='<button class=\'btn_bad tooltip\' data-type=\'dislike\'><em class=\'bull_tail\'></em><span class=\'tooltiptext tooltip-bottom\'>싫어요</span><span class=\'screenOut\'>나뻐요</span></button>',s+='<button class=\'btn_replay tooltip\' data-type=\'replace\'><em class=\'bull_tail\'></em><span class=\'tooltiptext tooltip-bottom\'>응답 다시 생성</span><span class=\'screenOut\'>replay</span></button>',s+='</div>','sLLM'==$('#chatmodel').val()&&e&&e.ref_url&&e.ref_url.length>1&&'<div class=\'btn_detail_wrap\'><button class=\'btn_detail\' onclick=\'goLink("'+e.ref_url+'");\'>상세 보러 가기</button></div>'}var n='<li class="new_message_balloon_area "><div class="message_balloon "><p class="question_tit">경기도아동언제나돌봄</p><p class="txt_conversation" aria-label="알림 내용">';if(n+=e.reply?e.reply:e,n+=s,'first'!=t&&'Y'==a)$(n);'first'==t?(n+='</p></div><p class="chat_time"></p><div class="category"><ul class="link_list"><li><a href="/always360/childcare/rsvtForm.do?key=2411190006">돌봄<br/>신청하기</a></li><li><a href="/always360/user/mypage/preInfoRegList.do?key=2401020023">사전<br/>아동등록</a></li><li><a href="/always360/childcareMap/search.do?key=2401020011">아동돌봄 <br/> 서비스 지도</a></li></ul></div><div class="ansCate"></div></li>',$('.chat_list').append(n.replace(/\\n/g,'<br>'))):$('.chat_list').append(n.replace(/\n/g,'<br>')),''==title&&(title=e.title),'A'==removedSuffix?$('.chat_time:last').text(getHour()).css({'text-decoration':'underline'}):$('.chat_time:last').text(getHour()),$('#sentence').keydown(),$('.chat_list').scrollTop($('.chat_list')[0].scrollHeight),$('.chat_list li').attr('tabindex','')}function checkTime(e){return e<10&&(e='0'+e),e}function escapeHtml(e){return null==e?'':e.toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;')}function ajaxAnswerSuccess(e,t){if('Y'==e.audio){var a=e.speech_file_path.replace('./','/');new Audio(chatUrl+''+a).play()}if('{}'==JSON.stringify(e));else{var s=e.reply.replace(/(?<!\d)\.(\s|\n)/g,'.<br>$1').replace(/\n/g,'<br>'),n=e.msg,r=e.out;if(null!=r&&'ddm3'!=$('#index').val()&&(r.forEach(function(e){if(''!=e.질문){var t=lastUsedNumber+=1;'<button class=\'question-btn\' data-target=\'answer-'+t+'\'>'+e.질문+'</button>','<p class=\'answer_box_tit\'>'+e.질문+'</p>';var a=e.답변.replace(/\n/g,'<br>').replace(/'/g,'&#39;');'<div class=\'typing_effect\' data-typing-content=\''+encodeURIComponent(a)+'\'></div>'}}),'</div>'),null!=s)try{var l=JSON.parse(s);doAnswer(wrapTemplate(l),l,t)}catch(a){doAnswer(e,n,t)}else doAnswer(errorMsg)}}Array.prototype.contains=function(e){for(var t in this)if(this[t]==e)return!0;return!1};