<div class="content"
     id="container">
    <form id="frm"
          name="frm"
          action="/always360/user/mypage/mypageForm.do"
          method="post">
        <input type="hidden"
               name="pwCheck"
               value="0">
        <div class="sub_wrap">
            <div class="inner">
                <div class="sub_top bg4 bg_trans">
                    <h2 class="sub_tit">개인정보관리</h2>
                </div>
                <div class="sub_con mt0">
                    <div class="manage_input_wrap">
                        <div class="max_960">
                            <div class="person_m_wrap">
                                <div class="box_wrap has_top_gray">
                                    <h3 class="p_tit">기본정보</h3>
                                    <div class="box">
                                        <div class="box_tit">이름</div>
                                        <div class="box_con">
                                            <div class="input_wrap">
                                                <input type="text"
                                                       value="구본민"
                                                       disabled=""
                                                       title="이름">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box">
                                        <div class="box_tit">연락처</div>
                                        <div class="box_con">
                                            <div class="input_wrap">
                                                <input type="text"
                                                       value="010-2112-6144"
                                                       disabled=""
                                                       title="연락처">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box">
                                        <div class="box_tit">아이디</div>
                                        <div class="box_con">
                                            <div class="input_wrap">
                                                <input type="text"
                                                       value="test78965"
                                                       disabled=""
                                                       title="아이디">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box">
                                        <div class="box_tit">생년월일</div>
                                        <div class="box_con">
                                            <div class="input_wrap">
                                                <input type="text"
                                                       value="1974년 07월 13일"
                                                       disabled=""
                                                       title="생년월일">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box">
                                        <div class="box_tit_wrap">
                                            <div class="box_tit">비밀번호</div>
                                            <a href="#"
                                               id="btn_popup3"
                                               class="white_btn type2">비밀번호 변경
                                            </a>
                                        </div>
                                    </div>
                                    <div class="box">
                                        <div class="box_tit">성별</div>
                                        <div class="box_con">
                                            <div class="raroundBoxWrap">
                                                <div class="raroundBox">
                                                    <input type="radio"
                                                           id="userSexdstnM"
                                                           name="userSexdstn"
                                                           value="M"
                                                           checked=""><label for="userSexdstnM">남성</label>
                                                </div>
                                                <div class="raroundBox">
                                                    <input type="radio"
                                                           id="userSexdstnF"
                                                           name="userSexdstn"
                                                           value="F"><label for="userSexdstnF">여성</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box">
                                        <div class="box_tit">이메일</div>
                                        <div class="box_con">
                                            <div class="input_wrap">
                                                <input type="text"
                                                       id="emailId"
                                                       name="emailId"
                                                       value="kbm0713@daum.net"
                                                       placeholder="이메일을 입력해주세요. 예)gwff@gwff.go.kr"
                                                       title="이메일">
                                            </div>
                                        </div>
                                    </div>
                                    <% if (state === 'sns') { %>
                                        <div class="box sns_type">
                                            <div class="box_tit">SNS 연동</div>
                                            <ul class="sns_type_wrap">
                                                <li>
                                                    <span class="naver">네이버 연동완료</span>
                                                </li>
                                                <li>
                                                    <span class="kakao">카카오 연동완료</span>
                                                </li>
                                                <li>
                                                    <span class="google">구글 연동완료</span>
                                                </li>
                                                <li>
                                                    <span class="no_type">미연동</span>
                                                </li>
                                            </ul>
                                        </div>
                                    <% } %>
                                    <% if (state !== 'sns') { %>
                                        <div class="box">
                                            <div class="box_tit">SNS 연동여부</div>
                                            <ul class="sns_c_wrap">
                                                <li>
                                                    <span class="naver">네이버 로그인연결</span>
                                                    <a title="새창열림"
                                                       href="javascript:void(0);"
                                                       onclick="fncLoginNaver('Y');"
                                                       class="white_btn blue_line">연결하기
                                                    </a>
                                                </li>
                                                <li>
                                                    <span class="kakao">카카오 로그인연결</span>
                                                    <a title="새창열림"
                                                       href="javascript:void(0);"
                                                       onclick="fncLoginKakao('Y');"
                                                       class="white_btn   black_line">해지하기
                                                    </a>
                                                </li>
                                                <li>
                                                    <span class="google">구글 로그인연결</span>
                                                    <a title="새창열림"
                                                       href="javascript:void(0);"
                                                       onclick="fncLoginGoogle('Y');"
                                                       class="white_btn blue_line">연결하기
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    <% } %>
                                    <div class="box address_wrap">
                                        <div class="box_tit_wrap">
                                            <div class="box_tit">주소<strong class="required"
                                                                           title="필수">*</strong></div>
                                        </div>
                                        <div class="box_con">
                                            <div class="flex">
                                                <div class="input_wrap">
                                                    <input type="text"
                                                           id="userZip"
                                                           name="userZip"
                                                           value="05103"
                                                           disabled=""
                                                           placeholder="우편번호를 입력해주세요."
                                                           title="우편번호를 입력해주세요">
                                                </div>
                                                <a href="#"
                                                   id="srchAddr"
                                                   class="white_btn type2">우편번호 검색
                                                </a>
                                            </div>
                                            <div class="input_wrap">
                                                <input type="text"
                                                       id="userAddr"
                                                       name="userAddr"
                                                       value="서울 광진구 자양로5길 8"
                                                       disabled=""
                                                       placeholder="주소를 입력해주세요"
                                                       title="주소를 입력해주세요">
                                            </div>
                                            <div class="input_wrap">
                                                <input type="text"
                                                       id="userDaddr"
                                                       name="userDaddr"
                                                       value="111"
                                                       placeholder="상세주소를 입력해주세요"
                                                       title="상세주소를 입력해주세요">
                                                <input type="hidden"
                                                       id="sggNm"
                                                       name="sggNm"
                                                       value="광진구">
                                                <input type="hidden"
                                                       id="areaCd"
                                                       name="areaCd"
                                                       value="11215">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="agree_wrap">
                                    <div class="agree_line">
                                        <div class="tit">메일 수신동의</div>
                                        <div class="flex">
                                            <div class="raBox">
                                                <input type="radio"
                                                       id="emlRcptnYnY"
                                                       name="emlRcptnYn"
                                                       value="Y"
                                                       checked=""><label for="emlRcptnYnY">예</label>
                                            </div>
                                            <div class="raBox">
                                                <input type="radio"
                                                       id="emlRcptnYnN"
                                                       name="emlRcptnYn"
                                                       value="N"><label for="emlRcptnYnN">아니오</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="agree_line">
                                        <div class="tit">문자 수신동의</div>
                                        <div class="flex">
                                            <div class="raBox">
                                                <input type="radio"
                                                       id="smsRcptnYnY"
                                                       name="smsRcptnYn"
                                                       value="Y"
                                                       checked=""><label for="smsRcptnYnY">예</label>
                                            </div>
                                            <div class="raBox">
                                                <input type="radio"
                                                       id="smsRcptnYnN"
                                                       name="smsRcptnYn"
                                                       value="N"><label for="smsRcptnYnN">아니오</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="btn_wrap column">
                                    <a href="#"
                                       onclick="save();"
                                       class="primary_btn type1">저장하기
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="popup_wrap"
             id="popup3"
             tabindex="0"
             style="<%= state === 'layerPassword' ? 'display: block;' : '' ;%>">
            <div class="popup_header">
                <h2>비밀번호 변경</h2>
            </div>
            <div class="popup_con">
                <div class="popup_gray_box">
                    <dl>
                        <dt><label for="pass">현재 비밀번호</label></dt>
                        <dd><input type="password"
                                   id="pass"
                                   class="w100"
                                   placeholder="현재 비밀번호를 입력해주세요"></dd>
                    </dl>
                    <dl>
                        <dt><label for="newPass">신규 비밀번호</label></dt>
                        <dd><input type="password"
                                   id="newPass"
                                   class="w100"
                                   placeholder="신규 비밀번호를 입력해주세요"
                                   maxlength="24"></dd>
                        <dd class="txt_caution">※ 8~24자 이내 영문, 숫자, 특문 조합</dd>
                    </dl>
                    <dl>
                        <dt><label for="newPassChk">신규 비밀번호 재확인</label></dt>
                        <dd><input type="password"
                                   id="newPassChk"
                                   class="w100"
                                   placeholder="신규 비밀번호를 다시 입력해주세요"
                                   maxlength="24"></dd>
                    </dl>
                </div>
            </div>
            <div class="btn_wrap column_type">
                <a href="#"
                   id="changeBtn">비밀번호 변경
                </a>
                <a href="#"
                   id="cancelBtn"
                   class="no_type">취소
                </a>
            </div>
            <a href="#"
               class="btn_close"><span class="screenOut">닫기</span></a>
        </div>
    </form>
    <script src="<%= process.env.BASE_PATH %>/scripts/always360/lib/jquery-ui.min.js"></script>
    <script src="<%= process.env.BASE_PATH %>/scripts/always360/lib/jquery.validate.min.js"></script>
    <script src="<%= process.env.BASE_PATH %>/scripts/always360/utils.js"></script>
    <!-- 카카오 도로명주소 검색 -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript"
            src="<%= process.env.BASE_PATH %>/scripts/always360/jquery.kakaoUtils.js"></script>
    <script>
        var f = document.forms['frm'];
        $(document).ready(function () {
            // 주소
            $("#srchAddr, #userZip, #userAddr").searchAddr(function (data) {
                $("#userZip").val(data.zonecode);
                $("#userAddr").val(data.addr);
                $("#sggNm").val(data.sggNm);
                $("#areaCd").val(data.areaCd);
                $("#userDaddr").focus();
            });

            $("#changeBtn").click(function (e) {
                e.preventDefault();
                var pass = $("#pass").val();
                var newPass = $("#newPass").val();
                var newPassChk = $("#newPassChk").val();

                if (pass == '') {
                    alert("현재 비밀번호를 입력해주세요.");
                    $("#pass").focus();
                    return false;
                } else if (newPass == '') {
                    alert("신규 비밀번호를 입력해주세요.");
                    $("#newPass").focus();
                    return false;
                } else if (newPassChk == '') {
                    alert("신규 비밀번호 재확인을 입력해주세요.");
                    $("#newPassChk").focus();
                    return false;
                } else {
                    var userId = "{userSession.userId}";

                    if (!pwCheck(newPass)) {
                        alert("비밀번호는 8글자 이상 24글자 이내 영문, 숫자, 특문 조합으로 입력해주세요.");
                        return false;
                    } else if ((newPass.search(/\s/) != -1) || (newPass.indexOf(userId) != -1)) {
                        alert("비밀번호에 공백,ID를 포함할 수 없습니다.");
                        return false;
                    }
                }

                lodingFixedOn("로딩중 입니다.", 300, 100);
                $.ajax({
                    url     : "/always360/user/pswdChk.do",
                    type    : "POST",
                    data    : {
                        "userId"  : "test78965",
                        "userPswd": pass,
                    },
                    dataType: "json",
                    error   : function (request, status, error) {
                        alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                        lodingOff(document.body);
                    },
                    success : function (result) {
                        lodingOff(document.body);
                        if (result != null && result.length > 0) {
                            if (result[0].msg != '') {
                                alert(result[0].msg);
                                return false;
                            }
                            $.ajax({
                                url     : "/always360/user/mypage/passChange.do",
                                type    : "POST",
                                data    : {
                                    "userPswd": newPass
                                },
                                dataType: "json",
                                error   : function (request, status, error) {
                                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                                    lodingOff(document.body);
                                },
                                success : function (result) {
                                    lodingOff(document.body);
                                    alert("비밀번호가 변경되었습니다.");
                                    $("#cancelBtn").click();
                                }
                            });
                        }
                    }
                });
            });

            $("#cancelBtn").click(function (e) {
                var modalId = $('[id^="btn_popup"]').attr('id').split('_')[1]; // btn_ 부분을 제거하여 modalId를 가져옴
                var modalClass = '#' + modalId; // modalId를 사용하여 팝업의 ID를 생성
                var modal = document.querySelector(modalClass);
                var modalOverlay = document.querySelector('.bg_dimm');

                modal.style.display = 'none';
                modalOverlay.style.display = 'none';

                $("html, body").css({"overflow": ""});
                e.preventDefault();
            });

        });

        function fncLoginNaver(type) {
            if (type == 'N') {
                if (!confirm("SNS 연동을 해제하시겠습니까? 해제시 자동 로그인이 불가능합니다.")) {
                    return;
                }
            }

            var clientId = 'fOd3pUlyKxvcx8Y0FLuB';
            var redirectUri = 'https://www.gg.go.kr/always360/auth/naver_auth.do';
            var state = generateRandomString(6);	//보안을 위한 상태 매개변수
            var scope = 'email gender name birthdate mobile'; // 필요한 스코프 설정

            var authorizeUrl = 'https://nid.naver.com/oauth2.0/authorize';
            var queryParams = {
                response_type: 'code',
                client_id    : clientId,
                redirect_uri : redirectUri,
                state        : state,
                scope        : scope
            };

            var url = authorizeUrl + '?' + Object.keys(queryParams).map(function (key) {
                return key + '=' + queryParams[key];
            }).join('&');

            window.open(url, 'popupMobile', 'width=800, height=600, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no').focus();
        }

        function fncLoginKakao(type) {
            if (type == 'N') {
                if (!confirm("SNS 연동을 해제하시겠습니까? 해제시 자동 로그인이 불가능합니다.")) {
                    return;
                }
            }

            var url = "https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=47e3988496714f819725ac0220ae45be&redirect_uri=https://www.gg.go.kr/always360/auth/kakao_auth.do";
            window.open(url, 'popupMobile', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no').focus();
        }

        function fncLoginGoogle(type) {
            if (type == 'N') {
                if (!confirm("SNS 연동을 해제하시겠습니까? 해제시 자동 로그인이 불가능합니다.")) {
                    return;
                }
            }

            var oauth2Endpoint = 'https://accounts.google.com/o/oauth2/v2/auth';

            var params = {
                'client_id'             : '993034530851-ru0o2t4pvfl12df4tjnlq1m932tlff2a.apps.googleusercontent.com',
                'redirect_uri'          : 'https://www.gg.go.kr/always360/auth/google_auth.do',
                'response_type'         : 'code',
                'scope'                 : 'profile email',
                'include_granted_scopes': 'true',
                'state'                 : generateRandomString(6)
            };

            var queryString = Object.keys(params).map(function (key) {
                return key + '=' + encodeURIComponent(params[key]);
            }).join('&');

            var url = oauth2Endpoint + '?' + queryString;

            window.open(url, 'popupMobile', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no').focus();
        }

        //비밀번호 정규식 유효성 검사
        function pwCheck(v) {
            var regularPW = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{7,24}$/;
            return regularPW.test(v);
        }

        function save() {
            if (f.emailId.value == '') {
                alert("이메일을 입력 해주세요.");
                f.emailId.focus();
                return false;
            }

            if (!isEmail(f.emailId.value)) {
                alert("이메일주소 형식을 다시 확인해주세요.");
                f.emailId.focus();
                return false;
            }

            if (confirm("저장 하시겠습니까?")) {
                $('input').prop('disabled', false);
                lodingFixedOn("저장중 입니다.", 300, 180);

                f.action = "/always360/user/mypage/mypageUpdate.do";
                f.method = "post";
                f.submit();
            }
        }
    </script>
</div>